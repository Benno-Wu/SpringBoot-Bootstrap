function login(){let e=$("#StudentIDCode").val(),o=$("#Password").val();if($("input:checked")[0]&&e.length>0&&o.length>0){let s=$("input:checked")[0].id;fetch(`/${s}/login`,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:`${"student"===s?"studentID":"code"}=${e}&password=${o}`}).then(e=>e.json()).then(e=>{200!=e.code?message(e.message):(page.login=!0,e.obj.id=s,info(e.obj))}).catch(e=>{console.log(e),message("服务器错误")})}else message("填写表单后再提交")}function register(){$("#register").modal("hide");let e=$("input:checked")[0].id,o=$("#id").val(),s=$("#RPassword").val(),l=$("#RPassword2").val();if(s===l){let t="student"===e?{stuID:o,name:$("#name").val(),password:s,tel:$("#tel").val(),email:$("#email").val(),romm:$("#room").val()}:{code:o,name:$("#name").val(),password:s,tel:$("#tel").val()};fetch(`/${e}/register?password=${l}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(o=>{200!=o.code?message(o.message):(o.obj.id=e,info(o.obj))}).catch(e=>{console.log(e),message("服务器错误")})}else message("密码不相同")}function registerShow(){if($("input:checked")[0]){let e=$("input:checked")[0].id;$("#registerForm").html(registerView(e)),$("#register").modal("show")}else message("选择后再注册")}function registerView(e){let o={student:'\n<div class="form-group row">\n    <label for="id" class="col-sm-2 col-form-label">学号</label>\n    <div class="col-sm-10">\n        <input type="number" class="form-control" id="id"\n            aria-describedby="StudentIDHelpBlock" required min="100000">\n    </div>\n    <small id="StudentIDHelpBlock" class="form-text text-muted col">\n        只接受数字且长度大于5\n    </small>\n</div>\n<div class="form-group row">\n    <label for="RPassword" class="col-sm-2 col-form-label">密码</label>\n    <div class="col-sm-10">\n        <input type="password" class="form-control" id="RPassword" required>\n    </div>\n</div>\n<div class="form-group row">\n    <label for="RPassword2" class="col-sm-3 col-form-label">确认密码</label>\n    <div class="col-sm-9">\n        <input type="password" class="form-control" id="RPassword2" required>\n    </div>\n</div>\n<div class="form-group row">\n    <label for="email" class="col-sm-2 col-form-label">邮箱</label>\n    <div class="col-sm-10">\n        <input id="email" type="email" class="form-control" required />\n    </div>\n</div>\n<div class="form-row">\n    <div class="col-5">\n        <input type="text" class="form-control" placeholder="姓名" id="name" required>\n    </div>\n    <div class="col">\n        <input type="tel" class="form-control" placeholder="手机号码" id="tel" required\n            pattern="^\\d{11}$">\n    </div>\n    <div class="col">\n        <input type="text" class="form-control" placeholder="寝室编码" id="room" required>\n    </div>\n</div>',worker:'\n<div class="form-group row">\n<label for="id" class="col-sm-2 col-form-label">工号</label>\n<div class="col-sm-10">\n    <input type="text" class="form-control" id="id" required>\n</div>\n</div>\n<div class="form-group row">\n<label for="RPassword" class="col-sm-2 col-form-label">密码</label>\n<div class="col-sm-10">\n    <input type="password" class="form-control" id="RPassword" required>\n</div>\n</div>\n<div class="form-group row">\n<label for="RPassword2" class="col-sm-3 col-form-label">确认密码</label>\n<div class="col-sm-9">\n    <input type="password" class="form-control" id="RPassword2" required>\n</div>\n</div>\n<div class="form-row">\n<div class="col-5">\n    <input type="text" class="form-control" placeholder="姓名" id="name" required>\n</div>\n<div class="col">\n    <input type="tel" class="form-control" placeholder="手机号码" id="tel" required\n        pattern="^\\d{11}$">\n</div>\n</div>'};return o[e]}function init(){fetch("/repair/top5",{method:"POST"}).then(e=>e.json()).then(e=>{200!=e.code?message(e.message):(detail(e.obj),page.fixed={from:0,to:5},page.submitted={from:0,to:5})}).catch(e=>{console.log(e),message("服务器错误")})}function fix(e){let o={};if(o.room=e.target.previousElementSibling.previousElementSibling.innerText,o.note=e.target.previousElementSibling.innerText,page.login){if("worker"===(0!=$("#room").length?"student":"worker")){let e=document.getElementById("id").innerText.split("：")[1];fetch(`/repair/fix?code=${e}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(o)}).then(e=>e.json()).then(e=>{message(e.message),init()}).catch(e=>{console.log(e),message("服务器错误")})}else message("请维修工登录")}else message("请登录")}function pageUp(e){let o=e.target.dataset.type,s=2*page[o].from-page[o].to,l=page[o].from;s<0?message("到顶了！"):fetch(`/repair/${o}?from=${s}&to=${l}`,{method:"POST"}).then(e=>e.json()).then(e=>{if(200!=e.code)message(e.message);else{let t={};t[o]=e.obj,e.obj.length>0?(page[o]={from:s,to:l},detail(t)):message("到顶了！")}}).catch(e=>{console.log(e),message("服务器错误")})}function pageDown(e){let o=e.target.dataset.type,s=page[o].to,l=2*page[o].to-page[o].from;fetch(`/repair/${o}?from=${s}&to=${l}`,{method:"POST"}).then(e=>e.json()).then(e=>{if(200!=e.code)message(e.message);else{let t={};t[o]=e.obj,e.obj.length>0?(page[o]={from:s,to:l},detail(t)):message("到底了！")}}).catch(e=>{console.log(e),message("服务器错误")})}init();