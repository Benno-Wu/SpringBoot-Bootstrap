function detail(a){if("fixed"in a){let t=new String;a.fixed.forEach(a=>{t+=card({room:a.room,note:a.note,ability:"",bool:!0})}),t+=paged("fixed"),$("#fixed").html(t)}if("submitted"in a){let t=new String;a.submitted.forEach(a=>{t+=card({room:a.room,note:a.note,ability:"fix(event)",bool:!1})}),t+=paged("submitted"),$("#submitted").html(t)}}function card(a){return`<div class="card m-3 w-25 mh-50">\n    <div class="card-self m-3 h-100">\n        <h5 class="card-title">${a.room}</h5>\n        <p class="card-text ">${a.note}</p>\n        <button type="button" class="btn btn-primary mw-8r" onclick="${a.ability}" ${a.bool?"disabled":""}>已维修</button>\n    </div>\n</div>`}function paged(a){return`<div class="bottom-end m-3">\n    <nav aria-label="Page navigation example">\n        <ul class="pagination justify-content-end">\n            <li class="page-item"> <a class="page-link" onclick="pageUp(event)" data-type="${a}">Previous</a> </li>\n            <li class="page-item"> <a class="page-link" onclick="pageDown(event)" data-type="${a}">Next</a> </li>\n        </ul>\n    </nav>\n</div>`}function info(a){let t=infoView(a);$("#login").hide(),$("#pic").attr("src",a.photo),$("#info").html(t);let n=commonFunc(a.id);$("#upload").html(n[0]),$("#update").html(n[1])}function repair(a){let t={room:$("#room").val(),note:$("#note").val()};fetch(`/repair/submit?stuID=${a}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(a=>a.json()).then(a=>{message(a.message),init()}).catch(a=>{console.log(a),message("服务器错误")})}var upload={action:function(){let a=0!=$("#room").length?"student":"worker",t="student"===a?"stuID":"code",n=document.getElementById("id").innerText.split("：")[1],o=new FormData;o.append("file",document.getElementById("uploadPic").files[0]),o.append(t,n),fetch(`/${a}/uploadAvatar`,{method:"POST",body:o}).then(a=>a.json()).then(a=>{200!=a.code?message(a.message):($("#pic").attr("src",""),$("#pic").attr("src",a.message),$("#uploadModal").modal("hide"))}).catch(a=>{console.log(a),message("服务器错误")})}};function update(){let a=0!=$("#room").length?"student":"worker",t="student"===a?"studentID":"code",n=document.getElementById("id").innerText.split("：")[1],o=$("#Nid").val(),l=$("#OPassword").val(),e=$("#NPassword").val(),s="student"===a?{stuID:o,name:$("#name").val(),password:e,tel:$("#tel").val(),email:$("#email").val(),romm:$("#room").val(),photo:$("#pic").attr("src")}:{code:o,name:$("#name").val(),password:e,tel:$("#tel").val(),photo:$("#pic").attr("src")};fetch(`/${a}/update?password=${l}&${t}=${n}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(s)}).then(a=>a.json()).then(a=>{if(200!=a.code)message(a.message),$("#updateModal").modal("hide");else{let t=a.obj,n=infoView(t);$("#pic").attr("src",t.photo),$("#info").html(n),$("#updateModal").modal("hide")}}).catch(a=>{console.log(a),message("服务器错误")})}function infoView(a){let t=a,n=`\n        <div class="card-body">\n            <h5 class="card-title">姓名：${t.name}</h5>\n            <p class="card-text" id="id">学号：${t.stuID}</p>\n            <p class="card-text">电话：${t.tel}</p>\n        </div>\n        <div class="repair">\n            <div class="form-group">\n                <label for="room">寝室号</label>\n                <input type="text" class="form-control" id="room" value=${t.room} disabled>\n            </div>\n            <div class="form-group">\n                <label for="note">备注</label>\n                <textarea class="form-control" id="note" rows="5"></textarea>\n            </div>\n            <button type="button" class="btn btn-primary" \n                onclick="repair('${t.stuID}')"\n                >报修</button>\n        </div>`,o=`\n            <div class="card-body">\n                <h5 class="card-title">姓名：${t.name}</h5>\n                <p class="card-text" id="id">工号：${t.code}</p>\n                <p class="card-text">电话：${t.tel}</p>\n            </div>`;return"student"===t.id?n:o}function commonFunc(a){return['\n    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#uploadModal">\n        修改头像\n    </button>\n    <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="upload"\n        aria-hidden="true">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title" id="upload">上传</h5>\n                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                        <span aria-hidden="true">X</span>\n                    </button>\n                </div>\n                <div class="modal-body">\n                    <label class="col col-form-label" for="uploadPic" data-browse="选择图片">选择图片</label>\n                    <input type="file" id="uploadPic" accept="image/*">\n                </div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>\n                    <button type="button" class="btn btn-primary" onclick="upload.action()">上传</button>\n                </div>\n            </div>\n        </div>\n    </div>',`\n    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateModal">\n        更改个人信息\n    </button>\n    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="update"\n        aria-hidden="true">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title" id="update">更改</h5>\n                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                        <span aria-hidden="true">X</span>\n                    </button>\n                </div>\n                <div class="modal-body">\n                ${"student"===a?'<div class="form-group row">\n        <label for="Nid" class="col-sm-2 col-form-label">学号</label>\n        <div class="col-sm-10">\n            <input type="number" class="form-control" id="Nid"\n                aria-describedby="StudentIDHelpBlock" required min="100000">\n        </div>\n        <small id="StudentIDHelpBlock" class="form-text text-muted col">\n            只接受数字且长度大于5\n        </small>\n    </div>\n    <div class="form-group row">\n        <label for="OPassword" class="col-sm-2 col-form-label">旧密码</label>\n        <div class="col-sm-10">\n            <input type="password" class="form-control" id="OPassword" required>\n        </div>\n    </div>\n    <div class="form-group row">\n        <label for="NPassword" class="col-sm-3 col-form-label">新密码</label>\n        <div class="col-sm-9">\n            <input type="password" class="form-control" id="NPassword" required>\n        </div>\n    </div>\n    <div class="form-group row">\n        <label for="email" class="col-sm-2 col-form-label">邮箱</label>\n        <div class="col-sm-10">\n            <input id="email" type="email" class="form-control" required />\n        </div>\n    </div>\n    <div class="form-row">\n        <div class="col-5">\n            <input type="text" class="form-control" placeholder="姓名" id="name" required>\n        </div>\n        <div class="col">\n            <input type="tel" class="form-control" placeholder="手机号码" id="tel" required\n                pattern="^\\d{11}$">\n        </div>\n        <div class="col">\n            <input type="text" class="form-control" placeholder="寝室编码" id="room" required>\n        </div>\n    </div>':'<div class="form-group row">\n        <label for="Nid" class="col-sm-2 col-form-label">工号</label>\n        <div class="col-sm-10">\n            <input type="text" class="form-control" id="Nid" required>\n        </div>\n        </div>\n        <div class="form-group row">\n        <label for="OPassword" class="col-sm-2 col-form-label">旧密码</label>\n        <div class="col-sm-10">\n            <input type="password" class="form-control" id="OPassword" required>\n        </div>\n        </div>\n        <div class="form-group row">\n        <label for="NPassword" class="col-sm-3 col-form-label">新密码</label>\n        <div class="col-sm-9">\n            <input type="password" class="form-control" id="NPassword" required>\n        </div>\n        </div>\n        <div class="form-row">\n        <div class="col-5">\n            <input type="text" class="form-control" placeholder="姓名" id="name" required>\n        </div>\n        <div class="col">\n            <input type="tel" class="form-control" placeholder="手机号码" id="tel" required\n                pattern="^\\d{11}$">\n        </div>\n        </div>'}\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>\n                    <button type="button" class="btn btn-primary"\n                        onclick="update()">更改</button>\n                </div>\n            </div>\n        </div>\n    </div>`]}